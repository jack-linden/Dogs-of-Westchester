<html>
<head>
<title>Dogs of Westchester</title>

<script src="javascript/geomap.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script src="//cdn.datatables.net/1.10.7/js/jquery.dataTables.min.js"></script>
<script src="//cdn.datatables.net/plug-ins/1.10.7/integration/bootstrap/3/dataTables.bootstrap.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="//cdn.datatables.net/plug-ins/1.10.7/integration/bootstrap/3/dataTables.bootstrap.css">
<link rel="stylesheet" href="//cdn.datatables.net/1.10.7/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="/stylesheets/style.css">
<link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico" />
<link href='https://api.tiles.mapbox.com/mapbox.js/v2.2.1/mapbox.css' rel='stylesheet' />
<script src='https://api.tiles.mapbox.com/mapbox.js/v2.2.1/mapbox.js'></script>
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

<meta charset=utf-8 />

</head>
<body>
	<div id="map" class="map"></div>
	<script>
		var myLayer;
		function prepareMap() {
			$(document).ready(function() {
				var accesstoken = 'pk.eyJ1IjoiMTUzMGRvZ3Byb2plY3QiLCJhIjoiNzFmYjZiNWNiYTg0ODcxYzYwNzM3OTZiY2JlNzc0ODQifQ._SJtkTq_1yyADMyNnQdRQA';
				L.mapbox.accessToken = accesstoken;
				var map = L.mapbox.map('map').setView([ 41.079, -73.864 ], 10);
				myLayer = L.mapbox.featureLayer().addTo(map);
				map.scrollWheelZoom.enable();

			});
		}
		function populateMap(dogsArray) {

			var query = "XXX";
			var arrayOfCounts = parseDogs(dogsArray);

			var geojson = [];

			$.getJSON("javascript/geolocations.json", function(jsonresponse) {
				geojson = jsonresponse;
			});
			var filteredGeoJson = [];
			for (var i = 0; i < geojson.length; i++) {
				var location = geojson[i].properties.title;
				if (arrayOfCounts[location] != undefined || arrayOfCounts[location] != 0) {
					geojson[i].properties.description = "Found " + arrayOfCounts[location] + " dogs matching the query \"" + query + "\".";
					filteredGeoJson.push(geojson[i]);
				}
			}

			myLayer.setGeoJSON(filteredGeoJson);
		}

		function parseDogs(dogsArray) {
			var locationCounts = [];

			for (var i = 0; i < dogsArray.length; i++) {
				var location = dogsArray[i].location;
				if (locationCounts[location] == undefined) {
					locationCounts[location] = 0;
				}
				locationCounts[location]++;
			}

			return locationCounts;
		}
	</script>
</body>

</html>
